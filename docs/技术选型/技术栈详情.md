# 技术栈详情

> 本文档详细说明 PrismaX 各层的技术选型

---

## 前端技术栈

| 类别 | 选型 | 版本 | 说明 |
|------|------|------|------|
| 框架 | Next.js | 15+ | App Router + Server Components |
| UI 框架 | React | 19 | 最新版本 |
| UI 组件库 | shadcn/ui + Radix | - | 可定制性强，无样式锁定 |
| 样式方案 | Tailwind CSS | 3.x | 原子化 CSS，开发效率高 |
| 状态管理 | Zustand | 4.x | 轻量级，TypeScript 友好 |
| 数据请求 | TanStack Query | 5.x | 缓存、重试、乐观更新 |
| 表单处理 | React Hook Form + Zod | - | 类型安全的表单验证 |
| 国际化 | next-intl | - | Next.js 原生集成 |
| 图标 | Lucide React | - | 开源图标库 |
| 动画 | Framer Motion | - | 流畅的动画效果 |

### 为什么选择 shadcn/ui？

| 对比项 | shadcn/ui | Ant Design | Material UI |
|--------|-----------|------------|-------------|
| 可定制性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| 包体积 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐ |
| 样式锁定 | 无 | 有 | 有 |
| 学习成本 | 低 | 中 | 中 |
| 设计风格 | 现代简洁 | 企业风格 | Material |

---

## 后端技术栈

| 类别 | 选型 | 说明 |
|------|------|------|
| 框架 | Next.js API Routes | 与前端一体，开发效率高 |
| API 层 | tRPC | 端到端类型安全，无需手写 API 文档 |
| 数据库 ORM | Drizzle ORM | 轻量级，类型安全，性能好 |
| 数据库 | PostgreSQL + pgvector | 向量搜索支持，知识库必需 |
| 缓存 | Redis | Agent Runtime 状态管理 |
| 认证 | Better Auth | 轻量级认证方案 |
| 文件存储 | 本地文件系统 / S3 | 可配置 |

### 为什么选择 tRPC？

| 对比项 | tRPC | REST API | GraphQL |
|--------|------|----------|---------|
| 类型安全 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ |
| 开发效率 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| 学习成本 | 低 | 低 | 高 |
| 生态 | 中 | 高 | 高 |
| 适用场景 | 全栈 TypeScript | 通用 | 复杂查询 |

### 为什么选择 Drizzle ORM？

| 对比项 | Drizzle | Prisma | TypeORM |
|--------|---------|--------|---------|
| 性能 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| 类型安全 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 包体积 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ |
| SQL 控制 | 完全控制 | 抽象 | 部分控制 |
| 学习成本 | 低 | 低 | 中 |

---

## 桌面端技术栈

| 类别 | 选型 | 说明 |
|------|------|------|
| 框架 | Electron | 跨平台桌面应用 |
| 打包工具 | electron-builder | 多平台打包 |
| 本地数据库 | SQLite (better-sqlite3) | 轻量级本地存储 |
| 自动更新 | electron-updater | 应用自动更新 |
| 进程通信 | Electron IPC | 主进程与渲染进程通信 |

### Electron 架构

```
┌─────────────────────────────────────────────────────────────┐
│                      Electron 应用                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    主进程 (Main)                      │   │
│  │  • 窗口管理                                          │   │
│  │  • 系统托盘                                          │   │
│  │  • 本地数据库 (SQLite)                               │   │
│  │  • 文件系统操作                                      │   │
│  │  • 自动更新                                          │   │
│  └─────────────────────────────────────────────────────┘   │
│                          │ IPC                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                  预加载脚本 (Preload)                  │   │
│  │  • 安全的 API 暴露                                   │   │
│  │  • contextBridge                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                          │                                  │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                  渲染进程 (Renderer)                   │   │
│  │  • Next.js 应用                                      │   │
│  │  • React 组件                                        │   │
│  │  • 用户界面                                          │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 移动端技术栈（规划中）

| 类别 | 选型 | 说明 |
|------|------|------|
| 框架 | React Native | 跨平台移动应用 |
| 导航 | React Navigation | 路由管理 |
| 状态管理 | Zustand | 与 Web 端一致 |
| UI 组件 | 自定义 + NativeWind | Tailwind 风格 |
| 本地存储 | SQLite (expo-sqlite) | 本地数据 |

---

## 开发工具链

| 类别 | 选型 | 说明 |
|------|------|------|
| 包管理器 | pnpm | 快速，节省磁盘空间 |
| 构建工具 | Turbo | Monorepo 构建优化 |
| 代码规范 | ESLint + Prettier | 代码风格统一 |
| 类型检查 | TypeScript 5.x | 严格模式 |
| 测试框架 | Vitest + Playwright | 单元测试 + E2E 测试 |
| Git Hooks | Husky + lint-staged | 提交前检查 |
| 版本管理 | Changesets | 版本发布管理 |

---

## AI 相关技术栈

| 类别 | 选型 | 说明 |
|------|------|------|
| AI SDK | Vercel AI SDK | 流式响应处理 |
| 向量数据库 | pgvector | PostgreSQL 扩展 |
| Embedding | OpenAI / 通义千问 | 文本向量化 |
| 本地模型 | Ollama | 本地 LLM 运行 |

---

## 部署相关

| 类别 | 选型 | 说明 |
|------|------|------|
| 容器化 | Docker | 应用容器化 |
| 编排 | Docker Compose | 多容器编排 |
| 数据库 | pgvector/pgvector:pg17 | PostgreSQL + 向量扩展 |
| 缓存 | redis:7-alpine | Redis 缓存 |
