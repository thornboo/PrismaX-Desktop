# 开发环境配置

> 本文档描述 PrismaX-Desktop 开发环境配置指南

---

## 环境要求

### 必需软件

| 软件    | 版本 | 说明              |
| ------- | ---- | ----------------- |
| Node.js | 20+  | JavaScript 运行时 |
| pnpm    | 10+  | 包管理器          |
| Git     | 2.x  | 版本控制          |

### 可选软件

| 软件   | 版本   | 说明         |
| ------ | ------ | ------------ |
| Ollama | latest | 本地模型测试 |

---

## 安装步骤

### 1. 安装 Node.js

推荐使用 nvm 管理 Node.js 版本：

```bash
# macOS / Linux
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20

# Windows (使用 nvm-windows)
# 从 https://github.com/coreybutler/nvm-windows 下载安装
nvm install 20
nvm use 20
```

### 2. 安装 pnpm

```bash
# 通过 npm 安装
npm install -g pnpm

# 或使用 corepack (Node.js 16.13+)
corepack enable
corepack prepare pnpm@latest --activate
```

### 3. 克隆项目

```bash
git clone https://github.com/your-username/PrismaX-Desktop.git
cd PrismaX-Desktop
```

### 4. 安装依赖

```bash
pnpm install
```

说明（本地向量库 / 原生依赖）：

- 项目已接入 **LanceDB** 作为本地向量索引引擎（用于知识库语义检索），其 Node 端包含平台相关的原生包。
- 当前版本锁定为 `@lancedb/lancedb@0.22.3`（并安装对应的 `@lancedb/lancedb-<platform>@0.22.3`），以确保各平台存在可用的发布产物。

### 5. 配置环境变量

```bash
# 复制环境变量模板
cp .env.example .env.local

# 编辑环境变量
# 根据需要配置 API Keys
```

---

## 开发服务器

### 启动开发环境

```bash
# 启动开发服务器
pnpm dev

# 启动 Electron 开发环境
pnpm dev:electron
```

---

## IDE 配置

### VS Code

推荐安装的扩展：

- ESLint
- Prettier
- Tailwind CSS IntelliSense
- GitLens

推荐的 `.vscode/settings.json`：

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "typescript.tsdk": "node_modules/typescript/lib",
  "tailwindCSS.experimental.classRegex": [["cva\\(([^)]*)\\)", "[\"'`]([^\"'`]*).*?[\"'`]"]]
}
```

### WebStorm / IntelliJ IDEA

- 启用 ESLint 和 Prettier
- 配置 TypeScript 使用项目版本
- 启用 Tailwind CSS 支持

---

## 常见问题

### pnpm install 失败

```bash
# 清除缓存后重试
pnpm store prune
rm -rf node_modules
pnpm install
```

### 启动时报错：Cannot find module '@lancedb/lancedb-<platform>'

这是 LanceDB 平台原生包缺失导致（例如 macOS ARM64 需要 `@lancedb/lancedb-darwin-arm64`）。

排查与处理：

1. 确认 Node 版本满足要求（Node 20+）。
2. 重新安装依赖：`pnpm install`
3. 若仍失败，优先检查 `package.json` 中 `@lancedb/lancedb` 与 `optionalDependencies` 是否保持同一版本（当前应为 `0.22.3`）。

### Electron 启动失败

```bash
# 重新安装 Electron
pnpm rebuild electron
```

### 端口被占用

```bash
# 查找占用端口的进程
lsof -i :5173

# 终止进程
kill -9 <PID>
```
