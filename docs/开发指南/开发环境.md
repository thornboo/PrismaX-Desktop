# 开发环境

> 本文档描述 PrismaX 项目的开发环境搭建指南

---

## 环境要求

### 必需软件

| 软件 | 版本 | 说明 |
|------|------|------|
| Node.js | 20+ | JavaScript 运行时 |
| pnpm | 8+ | 包管理器 |
| Git | 2.x | 版本控制 |

### 可选软件

| 软件 | 版本 | 说明 |
|------|------|------|
| Docker | 24+ | 容器化部署 |
| PostgreSQL | 16+ | 数据库（Web 版开发） |
| Redis | 7+ | 缓存（Web 版开发） |
| Ollama | latest | 本地模型测试 |

---

## 安装步骤

### 1. 安装 Node.js

推荐使用 nvm 管理 Node.js 版本：

```bash
# macOS / Linux
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20

# Windows (使用 nvm-windows)
# 下载安装 https://github.com/coreybutler/nvm-windows
nvm install 20
nvm use 20
```

### 2. 安装 pnpm

```bash
# 使用 npm 安装
npm install -g pnpm

# 或使用 corepack (Node.js 16.13+)
corepack enable
corepack prepare pnpm@latest --activate
```

### 3. 克隆项目

```bash
git clone https://github.com/your-username/PrismaX.git
cd PrismaX
```

### 4. 安装依赖

```bash
pnpm install
```

### 5. 配置环境变量

```bash
# 复制环境变量模板
cp .env.example .env.local

# 编辑环境变量
# 根据需要配置 API Key 等
```

---

## 开发服务器

### Web 版开发

```bash
# 启动开发服务器
pnpm dev:web

# 访问 http://localhost:3000
```

### 桌面版开发

```bash
# 启动桌面应用开发
pnpm dev:desktop

# 会自动打开 Electron 窗口
```

### 同时开发

```bash
# 同时启动 Web 和桌面版
pnpm dev
```

---

## 数据库配置

### 本地 PostgreSQL

```bash
# 使用 Docker 启动 PostgreSQL
docker run -d \
  --name prismax-postgres \
  -e POSTGRES_DB=prismax \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -p 5432:5432 \
  pgvector/pgvector:pg16

# 配置环境变量
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/prismax
```

### 本地 Redis

```bash
# 使用 Docker 启动 Redis
docker run -d \
  --name prismax-redis \
  -p 6379:6379 \
  redis:7-alpine

# 配置环境变量
REDIS_URL=redis://localhost:6379
```

### 使用 Docker Compose

```bash
# 启动所有服务
cd docker
docker-compose -f docker-compose.dev.yml up -d
```

---

## IDE 配置

### VS Code

推荐安装以下扩展：

- ESLint
- Prettier
- Tailwind CSS IntelliSense
- TypeScript Vue Plugin (Volar)
- GitLens

推荐配置 `.vscode/settings.json`：

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "typescript.tsdk": "node_modules/typescript/lib",
  "tailwindCSS.experimental.classRegex": [
    ["cva\\(([^)]*)\\)", "[\"'`]([^\"'`]*).*?[\"'`]"]
  ]
}
```

### WebStorm / IntelliJ IDEA

- 启用 ESLint 和 Prettier
- 配置 TypeScript 使用项目版本
- 启用 Tailwind CSS 支持

---

## 常见问题

### pnpm install 失败

```bash
# 清除缓存重试
pnpm store prune
rm -rf node_modules
pnpm install
```

### Electron 启动失败

```bash
# 重新安装 Electron
cd apps/desktop
pnpm rebuild electron
```

### 数据库连接失败

1. 检查 PostgreSQL 是否运行
2. 检查环境变量配置
3. 检查防火墙设置

### 端口被占用

```bash
# 查找占用端口的进程
lsof -i :3000

# 终止进程
kill -9 <PID>
```
